{"id":"opencode-swarm-monorepo-lf2p4u-mjd4pdh5651","title":"Make hive_sync bidirectional (import from JSONL after git pull)","description":"## Problem\nhive_sync is EXPORT-ONLY (PGLite → JSONL → git). Import from JSONL only happens ONCE via auto-migration when the database is empty.\n\n**Scenario that breaks:**\n1. Agent A creates cells → hive_sync → pushes to git\n2. Agent B pulls from git → gets new cells in .hive/issues.jsonl\n3. Agent B runs any hive tool → autoMigrateFromJSONL() sees existing cells → SKIPS IMPORT\n4. Agent B can't see Agent A's cells → coordination breaks\n\n## Current Architecture\n- `autoMigrateFromJSONL()` checks if DB has any cells, skips import if so\n- `hive_sync` only exports (FlushManager.flush → git add/commit/push)\n- No mechanism to import new cells from JSONL after initial migration\n\n## Proposed Solution\nMake hive_sync truly bidirectional:\n1. **Pull first** - git pull to get latest JSONL\n2. **Import new cells** - parse JSONL, upsert cells not in PGLite (by ID)\n3. **Export dirty cells** - existing FlushManager.flush behavior\n4. **Push** - git add/commit/push\n\n## Key Constraint\nNeed merge strategy for conflicts (same cell ID modified in both JSONL and PGLite). Options:\n- Last-write-wins (by updated_at timestamp)\n- JSONL wins (git is source of truth)\n- PGLite wins (local changes take precedence)\n\n## Files\n- packages/opencode-swarm-plugin/src/hive.ts (hive_sync tool)\n- packages/swarm-mail/src/hive/jsonl.ts (importFromJSONL exists but unused)\n- packages/swarm-mail/src/hive/adapter.ts (may need upsert method)","status":"open","priority":1,"issue_type":"feature","created_at":"2025-12-19T17:13:57.113Z","updated_at":"2025-12-19T17:13:57.113Z","dependencies":[],"labels":[],"comments":[]}
{"id":"opencode-swarm-monorepo-lf2p4u-mjd4pjujc7e","title":"Fix overly strict task_id regex requiring 3+ segments","description":"## Bug\nThe task_id validation regex requires minimum 3 hyphen-separated segments:\n```\n/^[a-z0-9]+(-[a-z0-9]+){2,}(\\\\.[\\\\w-]+)?$/\n```\n\nThis breaks for projects with simple names like:\n- `myproject` (1 segment)\n- `my-project` (2 segments)\n\nOnly works for `my-cool-project` (3+ segments).\n\n## Error Message\n```json\n{\n  \"origin\": \"string\",\n  \"code\": \"invalid_format\",\n  \"message\": \"Invalid task ID format (expected: project-slug-hash with minimum 3 segments)\"\n}\n```\n\n## Root Cause\nCell ID format is `{project-slug}-{hash}-{timestamp}{random}` which creates variable segments based on project name. The regex assumes project names always have 2+ hyphens.\n\n## Fix\nChange `{2,}` to `{1,}` or remove the minimum entirely:\n```\n/^[a-z0-9]+(-[a-z0-9]+)+(\\\\.[\\\\w-]+)?$/\n```\n\nOr better: validate the structure differently (e.g., must end with hash pattern, not count segments).\n\n## Files to Check\n- packages/opencode-swarm-plugin/src/swarm-prompts.ts (WorkerHandoff schema)\n- packages/opencode-swarm-plugin/src/schemas/*.ts\n- Anywhere with task_id or bead_id validation","status":"open","priority":1,"issue_type":"bug","created_at":"2025-12-19T17:14:05.371Z","updated_at":"2025-12-19T17:14:05.371Z","dependencies":[],"labels":[],"comments":[]}